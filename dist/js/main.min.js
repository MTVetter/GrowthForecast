/*
 projections | 1.0.0 | 2019-08-06 
*/

"use strict";require(["esri/Map","esri/views/MapView","esri/widgets/BasemapToggle","esri/widgets/Zoom","esri/widgets/Home","esri/widgets/Search","esri/layers/FeatureLayer","esri/tasks/Locator","esri/geometry/Extent","esri/renderers/smartMapping/creators/color","esri/widgets/Legend","esri/tasks/QueryTask","esri/tasks/support/Query","https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js"],function(e,o,s,a,r,t,l,i,n,c,d,u,p,v){var b=new e({basemap:"streets-navigation-vector"}),m=new o({container:"viewDiv",map:b,center:[-95.444,29.756],zoom:8});m.ui.remove("zoom");var h=new s({view:m,nextBasemap:"satellite"});m.ui.add(h,"bottom-right");var g=new a({view:m});m.ui.add(g,"bottom-right");var f=new r({view:m});m.ui.add(f,"bottom-right");var y=new t({view:m,includeDefaultSources:!1,sources:[{locator:new i({url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"}),singleLineFieldName:"SingleLine",outFields:["Addr_type"],searchExtent:new n({xmax:-97.2928,ymax:30.7976,xmin:-93.2361,ymin:28.4605}),placeholder:"3555 Timmons Ln, Houston, TX"}]});m.ui.add(y,"bottom-right");var w=new d({view:m});m.ui.add(w,"top-right");var C=new l({url:"https://gis.h-gac.com/arcgis/rest/services/Forecast/Census_Tracts/MapServer/0"});b.add(C);var k=new l({url:"https://gis.h-gac.com/arcgis/rest/services/Forecast/TAZ_5217/MapServer/0",visible:!1});b.add(k);var x=new l({url:"https://gis.h-gac.com/arcgis/rest/services/Forecast/H3M/MapServer/0",visible:!1,title:"3 Square Mile Grid"});b.add(x);var S=$("#fldDropdown").val(),_=$("#yrDropdown").val();function F(e,o){var s={layer:C,field:e+"_"+o,basemap:b.basemap,classificationMethod:"quantile",colorScheme:{name:"div-blue-red",tags:"Custom color scheme",id:"above-and-below/streets-navigation-vector/div-blue-red",colors:[[254,229,217],[252,174,145],[251,106,74],[222,45,38],[165,15,21]],noDataColor:[0,0,0],colorsForClassBreaks:[{colors:[[254,229,217,.7]],numClasses:1},{colors:[[254,229,217,.7],[252,174,145,.7]],numClasses:2},{colors:[[254,229,217,.7],[252,174,145,.7],[251,106,74,.7]],numClasses:3},{colors:[[254,229,217,.7],[252,174,145,.7],[251,106,74,.7],[222,45,38,.7]],numClasses:4},{colors:[[254,229,217,.7],[252,174,145,.7],[251,106,74,.7],[222,45,38,.7],[165,15,21,.7]],numClasses:5}],outline:{color:{r:0,g:0,b:0,a:.25},width:"1px"}},legendOptions:{title:o+" - "+e}};c.createClassBreaksRenderer(s).then(function(e){C.renderer=e.renderer,C.visible||(k.visible=!1,C.visible=!0,x.visible=!1)})}function H(e,o){var s={layer:k,field:e+"_"+o,basemap:b.basemap,classificationMethod:"quantile",colorScheme:{name:"div-blue-red",tags:"Custom color scheme",id:"above-and-below/streets-navigation-vector/div-blue-red",colors:[[254,229,217],[252,174,145],[251,106,74],[222,45,38],[165,15,21]],noDataColor:[0,0,0],colorsForClassBreaks:[{colors:[[254,229,217,.7]],numClasses:1},{colors:[[254,229,217,.7],[252,174,145,.7]],numClasses:2},{colors:[[254,229,217,.7],[252,174,145,.7],[251,106,74,.7]],numClasses:3},{colors:[[254,229,217,.7],[252,174,145,.7],[251,106,74,.7],[222,45,38,.7]],numClasses:4},{colors:[[254,229,217,.7],[252,174,145,.7],[251,106,74,.7],[222,45,38,.7],[165,15,21,.7]],numClasses:5}],outline:{color:{r:0,g:0,b:0,a:.25},width:"1px"}},legendOptions:{title:o+" - "+e}};c.createClassBreaksRenderer(s).then(function(e){k.renderer=e.renderer,k.visible||(k.visible=!0,C.visible=!1,x.visible=!1)})}function L(e,o){var s={layer:x,field:e+"_"+o,basemap:b.basemap,classificationMethod:"natural-breaks",colorScheme:{name:"div-blue-red",tags:"Custom color scheme",id:"above-and-below/streets-navigation-vector/div-blue-red",colors:[[26,152,80],[145,207,96],[217,239,139],[255,255,191],[254,224,139],[252,141,89],[215,48,39]],noDataColor:[0,0,0],colorsForClassBreaks:[{colors:[[26,152,80,.7]],numClasses:1},{colors:[[26,152,80,.7],[145,207,96,.7]],numClasses:2},{colors:[[26,152,80,.7],[145,207,96,.7],[217,239,139,.7]],numClasses:3},{colors:[[26,152,80,.7],[145,207,96,.7],[217,239,139,.7],[255,255,191,.7]],numClasses:4},{colors:[[26,150,65,.7],[166,217,106,.7],[255,255,191,.7],[253,174,97,.7],[215,25,28,.7]],numClasses:5},{colors:[[26,152,80,.6],[145,207,96,.6],[255,255,191,.6],[254,224,139,.6],[252,141,89,.6],[215,48,39,.6]],numClasses:6},{colors:[[26,152,80,.6],[145,207,96,.6],[217,239,139,.6],[255,255,191,.6],[254,224,139,.6],[252,141,89,.6],[215,48,39,.6]],numClasses:7}],outline:{color:{r:0,g:0,b:0,a:.25},width:"0px"}},numClasses:5,legendOptions:{title:o+" - "+e}};c.createClassBreaksRenderer(s).then(function(e){x.renderer=e.renderer,x.visible||(k.visible=!1,C.visible=!1,x.visible=!0)})}function M(e){$("#Population").append("<canvas id='Population_chart'></canvas>");var o=$("#Population_chart"),s={datasets:[{data:[e.Household_Population_2018,e.Household_Population_2045],backgroundColor:["#d73347"],borderColor:"#d73347",fill:!1,label:"Household Population",pointBackgroundColor:"#d73347"}],labels:["2018","2045"]};return new v(o,{type:"line",data:s,options:{tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Year"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Household Population"},ticks:{callback:function(e){return parseFloat(e).toLocaleString()}}}]}}}),o}function B(e){$("#Household").append("<canvas id='Household_chart'></canvas>");var o=$("#Household_chart"),s={datasets:[{data:[e.Households_2018,e.Households_2045],backgroundColor:["#d73347"],borderColor:"#d73347",fill:!1,label:"Number of Households",pointBackgroundColor:"#d73347"}],labels:["2018","2045"]};return new v(o,{type:"line",data:s,options:{tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Year"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Number of Households"},ticks:{callback:function(e){return parseFloat(e).toLocaleString()}}}]}}}),o}function D(e){$("#Job").append("<canvas id='Job_chart'></canvas>");var o=$("#Job_chart"),s={datasets:[{data:[e.Jobs_2018,e.Jobs_2045],backgroundColor:["#d73347"],borderColor:"#d73347",fill:!1,label:"Number of Jobs",pointBackgroundColor:"#d73347"}],labels:["2018","2045"]};return new v(o,{type:"line",data:s,options:{tooltips:{mode:"index",intersect:!1},hover:{mode:"nearest",intersect:!0},scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Year"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Number of Jobs"},ticks:{callback:function(e){return parseFloat(e).toLocaleString()}}}]}}}),o}$("#fldDropdown").change(function(){S=$("#fldDropdown").val(),"tracts"==$("input:checked").val()?(console.log("tracts"),F(S,_)):"taz"==$("input:checked").val()?(console.log("taz"),H(S,_)):"grid"==$("input:checked").val()&&(console.log("grid"),L(S,_))}),$("#yrDropdown").change(function(){_=$("#yrDropdown").val(),"tracts"==$("input:checked").val()?F(S,_):"taz"==$("input:checked").val()?H(S,_):"grid"==$("input:checked").val()&&L(S,_)}),F(S,_),$("#tractsStyle").click(function(){F(S,_)}),$("#tazStyle").click(function(){H(S,_)}),$("#gridStyle").click(function(){L(S,_)}),m.on("click",function(e){"tracts"==$("input:checked").val()?function(e){var o={geometry:e,outFields:["*"],returnGeometry:!1};C.queryFeatures(o).then(function(e){M(e.features[0].attributes),B(e.features[0].attributes),D(e.features[0].attributes)}),$("#reportModal").modal("show")}(e.mapPoint):"taz"==$("input:checked").val()?function(e){var o={geometry:e,outFields:["*"],returnGeometry:!1};k.queryFeatures(o).then(function(e){M(e.features[0].attributes),B(e.features[0].attributes),D(e.features[0].attributes)}),$("#reportModal").modal("show")}(e.mapPoint):"grid"==$("input:checked").val()&&function(e){var o={geometry:e,outFields:["*"],returnGeometry:!1};x.queryFeatures(o).then(function(e){M(e.features[0].attributes),B(e.features[0].attributes),D(e.features[0].attributes)}),$("#reportModal").modal("show")}(e.mapPoint)}),$("#reportModal").on("hidden.bs.modal",function(){$("#Population_chart").remove(),$("#Household_chart").remove(),$("#Job_chart").remove()})});